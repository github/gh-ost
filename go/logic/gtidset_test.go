/*
	Copyright 2019 Zach Moazeni.
	See https://github.com/github/gh-ost/blob/master/LICENSE
*/

package logic

import (
	"testing"

	test "github.com/outbrain/golib/tests"
)

func TestRevert(t *testing.T) {
	{
		set := NewGTIDSet("00005722-2222-2222-2222-222222222222", "00005721-1111-1111-1111-111111111111:1-52")
		newGTIDs := set.Revert("00005721-1111-1111-1111-111111111111:1-54,\n00005722-2222-2222-2222-222222222222:1-7")
		test.S(t).ExpectEquals(newGTIDs, "00005721-1111-1111-1111-111111111111:1-54")
	}
	{
		set := NewGTIDSet("00005722-2222-2222-2222-222222222222", "00005721-1111-1111-1111-111111111111:1-52")
		newGTIDs := set.Revert("00005721-1111-1111-1111-111111111111:1-54")
		test.S(t).ExpectEquals(newGTIDs, "00005721-1111-1111-1111-111111111111:1-54")
	}
	{
		set := NewGTIDSet("00005722-2222-2222-2222-222222222222", "00005721-1111-1111-1111-111111111111:1-52,\n00005722-2222-2222-2222-222222222222:1-7")
		newGTIDs := set.Revert("00005721-1111-1111-1111-111111111111:1-100,\n00005722-2222-2222-2222-222222222222:1-80")
		test.S(t).ExpectEquals(newGTIDs, "00005721-1111-1111-1111-111111111111:1-100,\n00005722-2222-2222-2222-222222222222:1-7")
	}
	{
		set := NewGTIDSet("00005722-2222-2222-2222-222222222222", "00005721-1111-1111-1111-111111111111:1-52,\n00005722-2222-2222-2222-222222222222:1-7")
		newGTIDs := set.Revert("00005721-1111-1111-1111-111111111111:1-100,\n00005722-2222-2222-2222-222222222222:1-80,\n00005722-3333-3333-3333-333333333333:1-5")
		test.S(t).ExpectEquals(newGTIDs, "00005721-1111-1111-1111-111111111111:1-100,\n00005722-2222-2222-2222-222222222222:1-7,\n00005722-3333-3333-3333-333333333333:1-5")
	}
}
